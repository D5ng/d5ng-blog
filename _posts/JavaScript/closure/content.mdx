---
title: Closure 알아보기
date: 2025-01-05
description: 클로저에 대해 알아보자.
thumbnail: /posts/JavaScript/closure/thumbnail.jpg
author: DongHyun Lee
profileImage: /profile.png
---

자바스크립트를 공부하다 보면 클로저라는 개념을 마주하게 된다. 클로저는 자바스크립트를 학습하는 많은 사람들에게 머리를 아프게한다. 그 이유는 클로저를 제대로 이해하기 위해 필요한 선행 지식들이 상당히 복잡하고, 이를 충분히 숙지하지 못하면 개념 자체를 이해하기 어려워지기 때문이다.

## 클로저를 이해하기 위한 선행지식

클로저를 제대로 이해하기 위해 반드시 알아야 할 선행 지식들이 필요하다.

- 렉시컬 스코프
- 실행 컨텍스트
- 일급 객체
- 생명 주기
- 함수형 프로그래밍

## 클로저란

클로저란 `함수가 선언된 렉시컬 환경을 기억하며, 외부 함수의 실행이 종료된 이후에도 외부 변수에 접근할 수 있는 함수`를 말한다. MDN 문서에서는 클로저를 다음과 같이 설명한다.

> A closure is the combination of a function and the lexical environment within which that function was declared.
> 클로저는 함수와 그 함수가 선언됐을 때의 렉시컬 환경(Lexical environment)과의 조합이다.

이 문장은 이해하기 어려울 수 있지만 밑에 내용을 보고서라도 이해가 안된다면, 그 때는 선행 지식들을 다시 공부하는게 좋다. 문장을 나누어 설명을 하면 다음과 같다.

### 함수가 선언된 렉시컬 환경이란?

자바스크립트는 렉시컬 스코프(Lexical Scope)를 따르며, 함수가 어디에서 정의되었는지에 따라 상위 스코프를 기억한다. 렉시컬 환경은 함수가 선언될 당시의 식별자와 스코프, 그리고 외부 렉시컬 환경에 대한 참조(상위 스코프)가 들어있는 환경이다. 따라서, `"함수가 선언된 렉시컬 환경"`이란 함수가 정의된 위치를 기준으로 구성된 변수와 스코프 정보를 의미한다고 이해할 수 있다.

### 외부 함수의 실행이 종료된 이후에도 외부 변수에 접근할 수 있는 함수란?

우선 위 문장을 이해하려면 생명 주기에 대해 알아야 한다. 생명 주기란 식별자(변수, 함수등)가 메모리에 생성되어 가비지 컬렉터에 의해 제거되는 과정을 말한다. 대부분의 식별자는 실행 컨텍스트 스택의 생성 및 제거와 함께 메모리에서 관리된다. 그러나 실행 컨텍스트 스택에서 제거된 이후에도 다른 곳에서 참조되고 있는 경우, 해당 식별자는 메모리에 유지된다.

그리고 함수가 선언된 렉시컬 환경 덕분에, 함수는 상위 스코프의 변수에 접근할 수 있다. 이는 함수가 스코프 체인(Scope Chain)을 따라 자신의 상위 스코프를 참조하기 때문이다. 따라서, `"외부 변수에 접근할 수 있는 함수"`라는 표현은, 함수가 선언된 렉시컬 환경을 기억하여 외부 변수를 참조할 수 있고, 해당 변수를 메모리에 유지할 수 있는 함수를 의미한다.

### 코드 예시

```ts
function counterState(initialValue: number) {
  let count = initialValue ?? 1

  const getCount = () => {
    return count
  }

  const setCount = (value: number) => {
    count = value
  }

  return [getCount, setCount] as const
}

const [getCount, setCount] = counterState(1)

console.log(getCount()) // 1

setCount(5)

console.log(getCount()) // 5
```

위 코드는 클로저의 예시다. `counterState`가 호출되어도 내부 변수인 `count`를 계속해서 참조하고 있다.
