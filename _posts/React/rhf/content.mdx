---
title: "React Hook Form과 유사하게 만들어보기"
date: 2024-09-10
description: 상태관리를 통해 React Hook Form과 유사한 DX를 가질 수 있도록 만들어봅시다. 🚀
thumbnail: /posts/react/rhf/thumbnail.jpg
author: DongHyun Lee
profileImage: /profile.png
---

## React Hook Form

React Hook Form(이하 RHF)은 비제어 컴포넌로 만들어져 불필요한 리 렌더링이 일어나지 않고, 여러 라이브러리와 호환이 되는 라이브러리입니다. RHF 공식 문서에서는 다음과 같이 소개하고 있습니다.

### Features

- 성능, UX 및 DX를 염두에 두고 구축됨
- 기본 HTML 양식 검증을 수용합니다.
- UI 라이브러리 와의 기본 통합
- 크기가 작고 종속성이 없습니다
- Yup , Zod , AJV , Superstruct , Joi 및 기타 지원
  > **사용하기 쉬운 검증 기능을 갖춘 성능이 뛰어나고 유연하며 확장 가능한 양식입니다.**

### RHF에 대한 내 생각 🤔

폼 상태를 관리할 때 없어선 안 될 굉장한 라이브러리라고 생각합니다. 하지만 뭐든지 간에 "**편한 것보단 정말 사용하는 게 맞을까?**"에 대한 고민을 해보면 좋을 것 같아요. 저 같은 경우엔 관리해야 할 Form이 많지 않다면 굳이 사용해야 할까? 입니다. 불필요한 리 렌더링이 일어나도 관리되는 Form이 몇 가지 안 된다면 성능과 관리하는 데 있어 큰 문제가 없기 때문에 사용할 필요가 없다고 생각해요.

시작하기 전에 "**RHF없이 어떻게 폼 관리를 할 수 있을까?**"에 대한 고민을 해보면 좋을 것 같습니다. 이제 본격적으로 한번 만들어 보겠습니다.

## React Hook Form 따라 만들기 🚀

### 들어가기 전에

앞으로 만들 기능들은 상태관리를 사용하여 다음과 같은 기능들을 만들어 아래에 보이는 코드처럼 작성하는것을 목표로 하고 있습니다.

- Register (onChange, onBlur, name, options)
- handleSubmit
- formState (values, touchedFields, errors)

```tsx
// 직접 만든 형태의 폼
export default function MyForm() {
  const { formState, register, handleSubmit } = useForm<DefaultValues>({ defaultValues })

  const submit = (data: DefaultValues) => {
    console.log(data)
  }

  return (
    <form onSubmit={handleSubmit(submit)}>
      <div>
        <label htmlFor="email">Email</label>
        <input type="text" {...register("email", emailValidation)} />
        {formState.touchedFields.email && <p>{formState.errors.email}</p>}
      </div>
      <div>
        <label htmlFor="password">Password</label>
        <input type="text" {...register("password", passwordValidation)} />
        {formState.touchedFields.email && <p>{formState.errors.email}</p>}
      </div>
      <button>Click</button>
    </form>
  )
}

// 리액트 훅 폼을 사용했을 때
export default function HookForm() {
  const { register, formState, handleSubmit } = useForm<DefaultValues>({ defaultValues, mode: "onBlur" })

  const submit = (data: DefaultValues) => {
    console.log(data)
  }

  return (
    <form onSubmit={handleSubmit(submit)}>
      <div>
        <label htmlFor="email">Email</label>
        <input type="text" {...register("email", emailValidation)} />
      </div>
      <div>
        <label htmlFor="password">Password</label>
        <input type="text" {...register("password", passwordValidation)} />
      </div>
      <button>Click</button>
    </form>
  )
}
```

어떠신가요? RHF를 사용하신 분들이라면 `오 거의 똑같은데 !??`라는 생각을 하실텐데요. 사실 만드는데에 있어 큰 어려움은 없었습니다. 저는 "RHF랑 똑같이 만들어보겠다"가 아닌 개발자가 사용하는 입장에서 "**유사한 DX를 만들어보자**"에 포커스 두었습니다. 나중에 라이브러리를 사용하지 않고 직접 만들어야하는 경우가 생긴다면, 그냥 만드는것 보단 최대한 어떤 라이브러리랑 비슷하게 만들어보는게 더 중요하다고 생각합니다 🙂

우선 간단한 예시로 로그인에 해당하는 이메일과 비밀번호를 만드는걸로 해보겠습니다. 필수 구현해야할 사항은 다음과 같습니다.

- 유효한 이메일 또는 비밀번호인지 검증하고 형식이 틀렸다면 에러 메세지 보여주기.
- 이메일과 비밀번호에 입력하지 않은채로 포커스 아웃되었을 때 에러 메세지 보여주기.
- 이메일과 비밀번호가 유효하지 않다면 버튼 비 활성화 처리하기.

### 시작하기

```ts
export type FieldValues = Record<string, any>

export declare function useForm<
  TFieldValues extends FieldValues = FieldValues,
  TContext = any,
  TTransformedValues extends FieldValues | undefined = undefined,
>(props?: UseFormProps<TFieldValues, TContext>): UseFormReturn<TFieldValues, TContext, TTransformedValues>
```

우선 RHF의 내부 소스 코드를 봐봅시다. `useForm`에서 제네릭으로 타입을 받고 있네요. 제네릭이 설정 되어 있지 않다면 `FieldValues`를 기본 값으로 사용하라고 되어있네요. 저희는 defaultValues만 넘겨줄거라서 UseFormProps 안 볼거에요. UseFormReturn을 반환하고 있는데 내부 코드를 한번 보겠습니다.

```ts
export type UseFormReturn<
  TFieldValues extends FieldValues = FieldValues,
  TContext = any,
  TTransformedValues extends FieldValues | undefined = undefined,
> = {
  watch: UseFormWatch<TFieldValues>
  getValues: UseFormGetValues<TFieldValues>
  getFieldState: UseFormGetFieldState<TFieldValues>
  setError: UseFormSetError<TFieldValues>
  clearErrors: UseFormClearErrors<TFieldValues>
  setValue: UseFormSetValue<TFieldValues>
  trigger: UseFormTrigger<TFieldValues>
  formState: FormState<TFieldValues>
  resetField: UseFormResetField<TFieldValues>
  reset: UseFormReset<TFieldValues>
  handleSubmit: UseFormHandleSubmit<TFieldValues, TTransformedValues>
  unregister: UseFormUnregister<TFieldValues>
  control: Control<TFieldValues, TContext>
  register: UseFormRegister<TFieldValues>
  setFocus: UseFormSetFocus<TFieldValues>
}
```
